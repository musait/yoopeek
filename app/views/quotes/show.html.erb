<%= content_for :body_style do %>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
<% end %>
<!-- Dashboard Headline -->
<div class="dashboard-headline">
	<h3><%= raw I18n.t('.quotes.show.quote_recap', quote_number: @quote.quote_number) %></h3>
</div>

<!-- Row -->
<div class="row">

	<!-- Dashboard Box -->
	<div class="col-xl-12">
		<div class="dashboard-box margin-top-0">

			<!-- Headline -->
			<div class="headline">
        <% case @quote.status %>
          <% when "created" %>
				    <h3><i class="icon-feather-folder-plus"></i> Proposition en attente d'acceptation <mark class="color" style="background-color: orange"><%= raw I18n.t('.quotes.show.quote_in_progress') %></mark></h3>
          <% when "declined" %>
            <h3><i class="icon-feather-folder-plus"></i> Proposition declinée <mark class="color" style="background-color: #e53038"><%= raw I18n.t('.quotes.show.quote_decline') %></mark></h3>
          <% else %>
            <h3><i class="icon-feather-folder-plus"></i> Proposition acceptée <mark class="color" style="background-color: #28b661"><%= raw I18n.t('.quotes.show.quote_accepted') %></mark></h3>
        <% end %>
      </div>

			<div class="content with-padding padding-bottom-10">
				<div class="row">
					<div class="col-xl-8" style="background-color: white">
			      <div class="row">
			        <div class="col-12" >
								<table id="quote_datatable">
									<thead>
										<tr>
	                    <th><%= t('.description') %></th>
				              <th><%= t('.price') %></th>
				              <th><%= t('.quantity') %></th>
				              <th><%= t('.total_with_vat') %></th>
	          				</tr>
									</thead>
									<tbody>
										<% @quote.quote_elements.each do |qe| %>
											<tr>
	            					<td><%= qe.content %></td>
	            					<td><%= qe.price %></td>
	            					<td><%= qe.quantity %></td>
	                      <td><%= qe.total %></td>
	            				</tr>
										<% end %>
									</tbody>
          			</table>
			        </div>
			      </div>
			    </div>
			    <div class="col-xl-4 col-lg-4 margin-top-0 margin-bottom-60">
						<% if current_user.is_customer %>
							<div class="">
								<!-- Overview -->
								<div class="freelancer-overview">
									<div class="freelancer-overview-inner d-flex">
										<!-- Bookmark Icon -->
										<!-- Avatar -->
										<div class="freelancer-avatar">
											<div class="verified-badge"></div>
											<a href="/theme/user/hireo/single-freelancer-profile.html"><img src="/theme/user/hireo/images/user-avatar-big-01.jpg" alt=""></a>
										</div>

										<!-- Name -->
										<div class="freelancer-name">
											<h4><a href="/theme/user/hireo/single-freelancer-profile.html"> <%= @quote.user.full_name %></a></h4>
											<span>Photographe</span><br>
											<span class="star-rating" data-rating="5.0"></span>
										</div>
										<!-- Rating -->
									</div>
	                <% if current_user.have_one_room_with_user(@quote.job.customer) %>
	      						<%= link_to room_path(id: Room.where(author_id:current_user.id,receiver_id: @quote.job.customer.id).or(Room.where(receiver_id:current_user.id,author_id: @quote.job.customer.id)).first.id),class:"button margin-bottom-10" do %>
	      							<%= raw I18n.t('.quotes.show.send_mp') %>
	      						<% end %>
	      					<% end %>

								</div>
							</div>
						<% end %>
			      <div class="boxed-widget summary margin-top-0">
			        <div class="boxed-widget-headline">
			          <h3><%= raw I18n.t('.quotes.show.summary') %></h3>
			        </div>
			        <div class="boxed-widget-inner">
			          <ul>
			            <li><%= raw I18n.t('.quotes.show.global_total_without_vat') %> <span><%= number_to_currency(@quote.total_without_vat) %></span></li>
			            <li><%= raw I18n.t('.quotes.show.vat') %> <span><%= number_to_currency(@quote.vat) %></span></li>
			            <li class="total-costs"><%= raw I18n.t('.quotes.show.total_with_vat') %> <span><%= number_to_currency(@quote.total_within_vat) %></span></li>
			          </ul>
			        </div>
			      </div>
						<% if current_user.is_customer %>
							<div class="row margin-top-30">
								<div class="col-12"style="display: flex; justify-content:center">
	                <% case @quote.status %>
	                <% when "created" %>
	                  <%= link_to t('.decline'), decline_quote_path(quote: @quote),style:"margin-right: 10px;display: flex; align-items: center" %>
	                  <%= link_to t('.accept_quote'), accept_quote_path(quote: @quote),class:"button" %>
	                <% when "accepted" %>
	                  <p>Vous avez accépter ce devis. Un message a été envoyé au professionel pour l'informer de votre accord. Si au bout de 24-48h <br>
	                  il n'est pas revenu vers vous, contactez-le ! </p>
	                <% else %>
	                  <p>Vous avez refuser ce devis. Un message a été envoyé au professionel pour l'informer de votre refus. Il reviendras peut-être vers pour
	                  faire une autre proposition.</p>
	                <% end %>
	              </div>
							</div>
						<% end %>
			      <!-- Summary -->

			    </div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Row / End -->

<div class="dashboard-footer-spacer"></div>
<%= content_for :body_script do %>
	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" charset="utf-8"></script>
	<script type="text/javascript">
		$(document).ready(function() {
		  $('#quote_datatable').dataTable({
        "language": {
          "url": 'http://cdn.datatables.net/plug-ins/1.10.16/i18n/French.json'
        }
      });
		});
	</script>
<% end %>
